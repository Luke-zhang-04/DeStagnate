<!DOCTYPE html>
<!--
  DeStagnate Docs
  Copyright (C) 2020 Luke Zhang | luke-zhang-04.github.io | MIT License
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DeStagnate Examples</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/themes/prism-tomorrow.min.css"/>
</head>
<body>
  <div class="p-4 bg-secondary">
    <h1>DeStagnate Examples</h1>
    <p>Here, you will find examples on how to use DeStagnate.</p>
    <ul>
      <li><a class="text-light" href="#counter-h">State example</a></li>
      <li><a class="text-light" href="#props-h">Props example</a></li>
      <li><a class="text-light" href="#elistener-h">Event listener example</a></li>
      <li><a class="text-light" href="#ref-h">Ref example</a></li>
      <li><a class="text-light" href="#calculator-h">Calculator example</a></li>
      <li><a class="text-light" href="#svg-h">Namespaced element (SVG) example</a></li>
      <li><a class="text-light" href="#nested-h">TicTacToe (nested component) example</a></li>
    </ul>
  </div>

  
  <div class="row" id="counter-h">
    <h1 class="mt-3 ml-4">State example</h1>
    <p class="ml-4">This example was written with JSX, which needs to be transpiled into DeStagnate.createElement() with the help of our CLI</p>
    <a class="ml-4" href="https://github.com/Luke-zhang-04/DeStagnate/blob/master/docs/src/counter.js" target="_blank" rel="noopener noreferrer">Source Code</a>
    <div class="col-6 pl-5 pt-5">
      <div id="counter"></div>
      <div id="state-btn"></div>
    </div>
    <div id="state-source" class="col-6">
      <pre class="d-block">
        <code class="language-jsx">
// Browser env, everything exposed to one global var, or namespace
const DS = DeStagnate,
  {createElement} = DS

class Counter extends DS.default {

  constructor (parent) {
    super(parent)

    this.state = {
      count: 0,
    }
  }

  componentDidMount = () => {
    setInterval(() => {
      this.setState({count: this.state.count + 1})
    }, 1000)
  }

  render = () => &lt;div&gt;
    &lt;p&gt;Seconds:&lt;/p&gt;
    &lt;p&gt;{this.state.count}&lt;/p&gt;
  &lt;/div&gt;

}

const counter = new Counter(document.querySelector("#counter"))

counter.mount() // Must call once
        </code>
      </pre>
      <pre class="d-none">
        <code class="language-jsx">
// Node env, import from node_modules, or use require
import DeStagnate, {createElement} from "destagnate"

class Counter extends DeStagnate {

  constructor (parent) {
    super(parent)

    this.state = {
      count: 0,
    }
  }

  componentDidMount = () => {
    setInterval(() => {
      this.setState({count: this.state.count + 1})
    }, 1000)
  }

  render = () => &lt;div&gt;
    &lt;p&gt;Seconds:&lt;/p&gt;
    &lt;p&gt;{this.state.count}&lt;/p&gt;
  &lt;/div&gt;

}

const counter = new Counter(document.querySelector("#counter"))

counter.mount() // Must call once
        </code>
      </pre>
    </div>
  </div>

  <div class="row" id="props-h">
    <h1 class="mt-3 ml-4">Props example</h1>
    <a class="ml-4" href="https://github.com/Luke-zhang-04/DeStagnate/blob/master/docs/src/props.js" target="_blank" rel="noopener noreferrer">Source Code</a>
    <div class="col-6 pl-5 pt-5">
      <div id="props"></div>
      <div id="props-btn" class="mt-3"></div>
    </div>
    <div id="props-source" class="col-6">
      <pre class="d-block">
        <code class="language-js">
// Browser env, everything exposed to one global var, or namespace
const DS = DeStagnate,
  {createElement} = DS                    

class PropsDemo extends DS.default {

  render = () => this.props.colors.map((color) => (
    createElement(
      "button",
      {class: `btn btn-${color}`},
      `${color} button`
    )
  ))

}

const propsDemo = new PropsDemo(
  document.querySelector("#props"),
  {
    colors: [
      "primary",
      "secondary",
      "success",
      "info",
      "warning",
      "danger",
      "light",
      "dark",
    ],
  },
)

propsDemo.mount() // Must call once
        </code>
      </pre>
      <pre class="d-none">
        <code class="language-js">
// Node env, import from node_modules, or use require
import DeStagnate, {createElement} from "destagnate"

class PropsDemo extends DeStagnate {

  render = () => this.props.colors.map((color) => (
    createElement(
      "button",
      {class: `btn btn-${color}`},
      `${color} button`
    )
  ))

}

const propsDemo = new PropsDemo(
  document.querySelector("#props"),
  {
    colors: [
      "primary",
      "secondary",
      "success",
      "info",
      "warning",
      "danger",
      "light",
      "dark",
    ],
  },
)

propsDemo.mount() // Must call once
        </code>
      </pre>
    </div>
  </div>

  <div class="row" id="elistener-h">
    <h1 class="mt-3 ml-4">Event listener example</h1>
    <p class="ml-4">This example was written partially with JSX, which needs to be transpiled into DeStagnate.createElement() with the help of our CLI</p>
    <a class="ml-4" href="https://github.com/Luke-zhang-04/DeStagnate/blob/master/docs/src/eventListener.js" target="_blank" rel="noopener noreferrer">Source Code</a>
    <div class="col-6 pl-5 pt-5">
      <div id="elistener"></div>
      <div id="elistener-btn" class="mt-3"></div>
    </div>
    <div id="elistener-source"class="col-6">
      <pre class="d-block">
        <code class="language-js">
// Browser env, everything exposed to one global var, or namespace
const DS = DeStagnate,
  {createElement} = DS

class EventListener extends DS.default {

  render = () => createElement(
    "button", {
      class: "btn btn-primary",
      onClick: () => alert("Clicked!")
    },
    "Click Me!",
  )
}

const eListener = new EventListener(
  document.querySelector("#elistener")
)

eListener.mount() // Must call once
        </code>
      </pre>
      <pre class="d-none">
        <code class="language-js">
// Node env, import from node_modules, or use require
import DeStagnate, {createElement} from "destagnate"

class EventListener extends DeStagnate {

  render = () => createElement(
    "button", {
      class: "btn btn-primary",
      onClick: () => alert("Clicked!")
    },
    "Click Me!",
  )

}

const eListener = new EventListener(
  document.querySelector("#elistener")
)

eListener.mount() // Must call once
        </code>
      </pre>
  </div>
  </div>

  <div class="row" id="ref-h">
    <h1 class="mt-3 ml-4">Ref example</h1>
    <p class="ml-4">This example was written with TypeScript, which needs to be compiled with out TypeScript or the CLI (which uses TSC)</p>
    <a class="ml-4" href="https://github.com/Luke-zhang-04/DeStagnate/blob/master/docs/src/ref.ts" target="_blank" rel="noopener noreferrer">Source Code</a>
    <div class="col-6 pl-5 pt-5">
      <div id="ref"></div>
      <div id="ref-btn"></div>
    </div>
    <div id="ref-source" class="col-6">
      <pre class="d-block">
        <code class="language-ts">
// Typescript declarations
declare type DeStagnate = typeof import("destagnate")
declare const DeStagnate: DeStagnate

// Browser env, everything exposed to one global var, or namespace
const DS = DeStagnate,
  {
    createElement,
    createRef,
  } = DS

class RefExample extends DS.default {

  private _inputGroupPrepend = (): HTMLElement => createElement(
    "div",
    {class: "input-group-prepend"},
    createElement(
      "span",
      {class: "input-group-text",},
      "Input"
    )
  )

  private _formRef = createRef&lt;HTMLInputElement&gt;()

  private _getInputValues = () => {
    const val = this._formRef.current?.value

    alert(`INPUT VALUE: "${val}"`)
  }

  public render = (): HTMLElement[] => [
    createElement(
      "div",
      {class: "input-group"},
      this._inputGroupPrepend(),
      createElement(
        "input",
        {
            type: "text",
            class: "form-control mb-3",
            placeholder: "Insert text here",
            ref: this._formRef,
        }
      )
    ),
    createElement(
      "button",
      {
        class: "btn btn-light mb-3",
        onClick: this._getInputValues
      },
      "Get input value"
    )
  ]

}

const refParent = document.getElementById("ref")

if (refParent) {
  const refComponent = new RefExample(refParent)

  refComponent.mount()
}  
        </code>
      </pre>
      <pre class="d-none">
        <code class="language-ts">
// Node env, import from node_modules, or use require
import DeStagnate, {
  createElement,
  createRef,
} from "destagnate"

class RefExample extends DeStagnate {

  private _inputGroupPrepend = (): HTMLElement => createElement(
    "div",
    {class: "input-group-prepend"},
    createElement(
      "span",
      {class: "input-group-text",},
      "Input"
    )
  )

  private _formRef = createRef&lt;HTMLInputElement&gt;()

  private _getInputValues = () => {
    const val = this._formRef.current?.value

    alert(`INPUT VALUE: "${val}"`)
  }

  public render = (): HTMLElement[] => [
    createElement(
      "div",
      {class: "input-group"},
      this._inputGroupPrepend(),
      createElement(
        "input",
        {
            type: "text",
            class: "form-control mb-3",
            placeholder: "Insert text here",
            ref: this._formRef,
        }
      )
    ),
    createElement(
      "button",
      {
        class: "btn btn-light mb-3",
        onClick: this._getInputValues
      },
      "Get input value"
    )
  ]

}

const refParent = document.getElementById("ref")

if (refParent) {
  const refComponent = new RefExample(refParent)

  refComponent.mount()
}
        </code>
      </pre>
    </div>
  </div>

  <div class="row" id="calculator-h">
    <h1 class="mt-3 ml-4">Calculator example</h1>
    <p class="ml-4">This example was written with JSX, which needs to be transpiled into DeStagnate.createElement() with the help of our CLI</p>
    <a class="ml-4" href="https://github.com/Luke-zhang-04/DeStagnate/blob/master/docs/src/calculator.js" target="_blank" rel="noopener noreferrer">Source Code</a>
    <div class="col-6 pl-5 pt-5">
      <div id="calculator"></div>
      <div id="calc-btn" class="mt-3"></div>
    </div>
    <div id="calc-source" class="col-6">
      <pre class="d-block">
        <code class="language-jsx">
// Browser env, everything exposed to one global var, or namespace
const DS = DeStagnate,
  {createElement} = DS
  
class Calculator extends DS.default {

  constructor (parent) {
    super(parent)

    this.state = {
      calculation: "",
    }
  }

  /**
   * Appends new values to calculation
   * @param {string} text - text of button
   * @param {string | undefined} append - value to append to
   * calculation
   * @returns {Object.&lt;string, string&gt;} new state
   */
  _appendState = (text, append) => ({
    calculation: this.state.calculation + (append ? append : text),
  })
 
 /**
  * Create a calculator button
  * @param {string} text - text of button
  * @param {string | undefined} append - value to append to
  * calculaton
  * @returns {HTMLElement} col element
  */
  _calcButton = (text, append) => createElement(
    "div",
    {
      class: "col-3 calc-btn", // Bootstrap grid
      onClick: () => this.setState(this._appendState(text, append)),
    },
    text,
  )

  /**
   * Evaluate current calculation
   * @returns {number} calculation
   */
  _evalCalc = () => eval(this.state.calculation)

  /**
   * Calculator buttons for 3 numbered rows
   * @type {Array.&lt;HTMLElement&gt;}
   */
  _numBtns = [
    &lt;div className="calc-btns row"&gt; 
      {["7", "8", "9", ["x", "*"]].map((val) => (
        this._calcButton(
          val instanceof Array ? val[0] : val,
          val instanceof Array ? val[1] : val,
        )
      ))}
    &lt;/div&gt;,
    &lt;div className="calc-btns row"&gt; 
      {["4", "5", "6", "-"].map((val) => (
        this._calcButton(
          val instanceof Array ? val[0] : val,
          val instanceof Array ? val[1] : val,
        )
      ))}
    &lt;/div&gt;,
    &lt;div className="calc-btns row"&gt; 
      {["1", "2", "3", "+"].map((val) => (
        this._calcButton(
          val instanceof Array ? val[0] : val,
          val instanceof Array ? val[1] : val,
        )
      ))}
    &lt;/div&gt;,
  ]

  /**
   * Calculator Display
   * @returns {HTMLElement} display
   */
  _calcDisplay = () => createElement(
    "div",
    {class: "calc-display"},
    this.state.calculation,
  )

  render = () => (
    &lt;div&gt;
      {this._calcDisplay()}
      &lt;div className="calc-btns row"&gt;
        &lt;div
          className="col-3 calc-btn clear"
          onClick={() => this.setState({calculation: ""})}
        &gt;C&lt;/div&gt;
        {createElement(
          "div",
          {
            class: "col-3 calc-btn",
            onClick: () => this.setState({
              calculation: this.state.calculation.slice(
                0, this.state.calculation.length - 1,
              ),
            }),
          },
          "\u2190"
        )}
        {this._calcButton("%")}
        {this._calcButton("\u00f7", "/")}
      &lt;/div&gt;
      {this._numBtns.map((btn) => btn)}
      {createElement(
        "div",
        {
          class: "calc-btns row"
        },
        [
          this._calcButton("0"),
          this._calcButton("."),
          createElement(
            "div",
            {
              class: "col-6 calc-btn equals",
              onClick: () => this.setState({
                calculation: this._evalCalc(),
              }),
            },
            "=" // Equals
          ),
        ]
      )}
    &lt;/div&gt;
  )

}

const calculator = new Calculator(
  document.querySelector("#calculator")
)

calculator.mount() // Must call once 
        </code>
      </pre>
      <pre class="d-none">
        <code class="language-jsx">
// Node env, import from node_modules, or use require
import DeStagnate, {createElement} from "destagnate"

class Calculator extends DeStagnate {

  constructor (parent) {
    super(parent)

    this.state = {
      calculation: "",
    }
  }

  /**
   * Appends new values to calculation
   * @param {string} text - text of button
   * @param {string | undefined} append - value to append to
   * calculation
   * @returns {Object.&lt;string, string&gt;} new state
   */
  _appendState = (text, append) => ({
    calculation: this.state.calculation + (append ? append : text),
  })
 
 /**
  * Create a calculator button
  * @param {string} text - text of button
  * @param {string | undefined} append - value to append to
  * calculaton
  * @returns {HTMLElement} col element
  */
  _calcButton = (text, append) => createElement(
    "div",
    {
      class: "col-3 calc-btn", // Bootstrap grid
      onClick: () => this.setState(this._appendState(text, append)),
    },
    text,
  )

  /**
   * Evaluate current calculation
   * @returns {number} calculation
   */
  _evalCalc = () => eval(this.state.calculation)

  /**
   * Calculator buttons for 3 numbered rows
   * @type {Array.&lt;HTMLElement&gt;}
   */
  _numBtns = [
    &lt;div className="calc-btns row"&gt; 
      {["7", "8", "9", ["x", "*"]].map((val) => (
        this._calcButton(
          val instanceof Array ? val[0] : val,
          val instanceof Array ? val[1] : val,
        )
      ))}
    &lt;/div&gt;,
    &lt;div className="calc-btns row"&gt; 
      {["4", "5", "6", "-"].map((val) => (
        this._calcButton(
          val instanceof Array ? val[0] : val,
          val instanceof Array ? val[1] : val,
        )
      ))}
    &lt;/div&gt;,
    &lt;div className="calc-btns row"&gt; 
      {["1", "2", "3", "+"].map((val) => (
        this._calcButton(
          val instanceof Array ? val[0] : val,
          val instanceof Array ? val[1] : val,
        )
      ))}
    &lt;/div&gt;,
  ]

  /**
   * Calculator Display
   * @returns {HTMLElement} display
   */
  _calcDisplay = () => createElement(
    "div",
    {class: "calc-display"},
    this.state.calculation,
  )

  render = () => (
    &lt;div&gt;
      {this._calcDisplay()}
      &lt;div className="calc-btns row"&gt;
        &lt;div
          className="col-3 calc-btn clear"
          onClick={() => this.setState({calculation: ""})}
        &gt;C&lt;/div&gt;
        {createElement(
          "div",
          {
            class: "col-3 calc-btn",
            onClick: () => this.setState({
              calculation: this.state.calculation.slice(
                0, this.state.calculation.length - 1,
              ),
            }),
          },
          "\u2190"
        )}
        {this._calcButton("%")}
        {this._calcButton("\u00f7", "/")}
      &lt;/div&gt;
      {this._numBtns.map((btn) => btn)}
      {createElement(
        "div",
        {
          class: "calc-btns row"
        },
        [
          this._calcButton("0"),
          this._calcButton("."),
          createElement(
            "div",
            {
              class: "col-6 calc-btn equals",
              onClick: () => this.setState({
                calculation: this._evalCalc(),
              }),
            },
            "=" // Equals
          ),
        ]
      )}
    &lt;/div&gt;
  )

}

const calculator = new Calculator(
  document.querySelector("#calculator")
)

calculator.mount() // Must call once 
        </code>
      </pre>
  </div>
  </div>

  <div class="row" id="svg-h">
    <h1 class="mt-3 ml-4">SVG/namespace example</h1>
    <a class="ml-4" href="https://github.com/Luke-zhang-04/DeStagnate/blob/master/docs/src/svg.js" target="_blank" rel="noopener noreferrer">Source Code</a>
    <div class="col-6 pl-5 pt-5">
      <div id="SVG"></div>
      <div id="svg-btn" class="mt-3"></div>
    </div>
    <div id="svg-source" class="col-6">
      <pre class="d-block">
        <code class="language-js"> 
// Browser env, everything exposed to one global var, or namespace
const DS = DeStagnate,
  {createElementNS} = DS

class SVG extends DS.default {

  constructor (parent, props) {
    super(parent, props)

    this.state = {
      xcord: 0,
    }
  }

  direction = 2.5

  componentDidMount = () => this.componentDidUpdate()

  componentDidUpdate = () => {
    if (
      this.state.xcord < 0 ||
      this.state.xcord > this.props.width / 2
    ) {
      this.direction *= -1
    }

    setTimeout(
      () => this.setState({
        xcord: this.state.xcord + this.direction,
      }),
      25,
    )
  }

  render = () => createElementNS(
    "http://www.w3.org/2000/svg",
    "svg",
    {
      width: this.props.width * 2,
      height: this.props.width,
      viewBox: `0 0 ${this.props.width * 2} ${this.props.width}`,
    },
    createElementNS(
      "http://www.w3.org/2000/svg",
      "rect",
      {
        width: this.props.width,
        height: this.props.width,
        fill: this.direction > 0 ? "#0D6EFD" : "#28A745",
        x: this.state.xcord,
      },
    ),
  )

}

const svg = new SVG(document.querySelector("#SVG"), {width: 250})

svg.mount() // Must call once
        </code>
      </pre>
      <pre class="d-none">
        <code class="language-js">
// Node env, import from node_modules, or use require
import DeStagnate, {createElementNS} from "destagnate"

class SVG extends DeStagnate {

  constructor (parent, props) {
    super(parent, props)

    this.state = {
      xcord: 0,
    }
  }

  direction = 2.5

  componentDidMount = () => this.componentDidUpdate()

  componentDidUpdate = () => {
    if (
      this.state.xcord < 0 ||
      this.state.xcord > this.props.width / 2
    ) {
      this.direction *= -1
    }

    setTimeout(
      () => this.setState({
        xcord: this.state.xcord + this.direction,
      }),
      25,
    )
  }

  render = () => createElementNS(
    "http://www.w3.org/2000/svg",
    "svg",
    {
      width: this.props.width * 2,
      height: this.props.width,
      viewBox: `0 0 ${this.props.width * 2} ${this.props.width}`,
    },
    createElementNS(
      "http://www.w3.org/2000/svg",
      "rect",
      {
        width: this.props.width,
        height: this.props.width,
        fill: this.direction > 0 ? "#0D6EFD" : "#28A745",
        x: this.state.xcord,
      },
    ),
  )

}

const svg = new SVG(document.querySelector("#SVG"), {width: 250})

svg.mount() // Must call once
        </code>
      </pre>
  </div>
  </div>

  <div class="row" id="nested-h">
    <h1 class="mt-3 ml-4">TicTacToe (nested components) example</h1>
    <p class="ml-4">This example was written with TypeScript, which needs to be compiled with out TypeScript or the CLI (which uses TSC)</p>
    <a class="ml-4" href="https://github.com/Luke-zhang-04/DeStagnate/blob/master/docs/src/tictactoe.ts" target="_blank" rel="noopener noreferrer">Source Code</a>
    <div class="col-6 pl-5 pt-5">
      <div class="btn btn-danger" id="nested-reset-btn">Reset</div>
      <div id="nested" class="my-3"></div>
      <div id="nested-btn"></div>
    </div>
    <div id="nested-source" class="col-6">
      <pre class="d-block">
        <code class="language-ts">
// Typescript declarations
declare type DeStagnate = typeof import("destagnate")
declare const DeStagnate: DeStagnate

// Browser env, everything exposed to one global var, or namespace
const DS = DeStagnate,
  {
    createDSComponent,
    createRef,
    createElement,
  } = DS

// Current player
let currentPlayer: "x" | "o" = "x"

// Interfaces for states
interface SquareState {
  clicked: "" | "x" | "o",
}

class TicTacToe extends DS.default {

  private _squares = [ // Refs, simillar to React refs
    [createRef&lt;Square&gt;(), createRef&lt;Square&gt;(), createRef&lt;Square&gt;()],
    [createRef&lt;Square&gt;(), createRef&lt;Square&gt;(), createRef&lt;Square&gt;()],
    [createRef&lt;Square&gt;(), createRef&lt;Square&gt;(), createRef&lt;Square&gt;()],
  ]

  private _checkForWinner = (): SquareState["clicked"] => {
    for (let i = 0; i < 3; i++) {
      const rows = [0, 1, 2].map((val) => this._squares[i][val]
        .current
        ?.getState
        .clicked
      )

      const columns = [0, 1, 2].map((val) => this._squares[val][i]
        .current
        ?.getState
        .clicked
      )

      if (
        rows[0] === rows[1] &&
        rows[1] === rows[2] &&
        rows[0]
      ) {
        return rows[0]
      } else if (
        columns[0] === columns[1] &&
        columns[1] === columns[2] &&
        columns[0]
      ) {
        return columns[0]
      }

    }

    const diagonals = [
      [
        this._squares[0][0].current?.getState.clicked,
        this._squares[1][1].current?.getState.clicked,
        this._squares[2][2].current?.getState.clicked,
      ],
      [
        this._squares[0][2].current?.getState.clicked,
        this._squares[1][1].current?.getState.clicked,
        this._squares[2][0].current?.getState.clicked,
      ],
    ]

    for (const diagonal of diagonals) {
      if (
        diagonal[0] === diagonal[1] &&
        diagonal[1] === diagonal[2] &&
        diagonal[0]
      ) {
        return diagonal[0]
      }
    }

    return ""
  }

  public render = (): HTMLElement[] => [0, 1, 2]
    // Create 3 rows
    .map((val) => createElement(
      "div",
      {class: "row"},
      // Create 3 columns
      [0, 1, 2].map((val2) => createElement(
        "div",
        {
          class: "col-4",
          onClick: () => {
            // Current square
            const square = this._squares[val][val2]
              .current

            // Check if square isn't already clicked
            if (square?.getState.clicked === "") {
              square?.setState({clicked: currentPlayer})
            }

            // Change current player
            if (currentPlayer === "x") {
              currentPlayer = "o"
            } else {
              currentPlayer = "x"
            }

            if (this._checkForWinner()) {
              alert(
                `Player ${this._checkForWinner()} has won the game!`
              )
            }
          },
        },
        createDSComponent(
          Square,
          {},
          this._squares[val][val2],
        )
      ))
    ))

}

class Square extends DS.default<{}, SquareState> {

  public constructor (parent: HTMLElement) {
    super(parent)

    this.state = {
      clicked: "",
    }
  }

  public render = (): HTMLElement => createElement(
    "div",
    {class: "tictactoe-square",},
    this.state.clicked,
  )

}

const tictactoeParent = document.getElementById("nested")

const mountTicTacToe = (): void => {
  if (tictactoeParent) {
    const tictactoe = new TicTacToe(tictactoeParent),
      resetBtn = document.getElementById("nested-reset-btn")
  
    if (resetBtn) {
      resetBtn.addEventListener("click", () => {
        tictactoe.unmount()

        mountTicTacToe()
      })
    }
  
    tictactoe.mount()
  }
}

mountTicTacToe()
        </code>
      </pre>
      <pre class="d-none">
        <code class="language-ts">
// Node env, import from node_modules, or use require
import DeStagnate, {
  createDSComponent,
  createElement,
  createRef,
} from "destagnate"

// Current player
let currentPlayer: "x" | "o" = "x"

// Interfaces for states
interface SquareState {
  clicked: "" | "x" | "o",
}

class TicTacToe extends DeStagnate {

  private _squares = [ // Refs, simillar to React refs
    [createRef&lt;Square&gt;(), createRef&lt;Square&gt;(), createRef&lt;Square&gt;()],
    [createRef&lt;Square&gt;(), createRef&lt;Square&gt;(), createRef&lt;Square&gt;()],
    [createRef&lt;Square&gt;(), createRef&lt;Square&gt;(), createRef&lt;Square&gt;()],
  ]

  private _checkForWinner = (): SquareState["clicked"] => {
    for (let i = 0; i < 3; i++) {
      const rows = [0, 1, 2].map((val) => this._squares[i][val]
        .current
        ?.getState
        .clicked
      )

      const columns = [0, 1, 2].map((val) => this._squares[val][i]
        .current
        ?.getState
        .clicked
      )

      if (
        rows[0] === rows[1] &&
        rows[1] === rows[2] &&
        rows[0]
      ) {
        return rows[0]
      } else if (
        columns[0] === columns[1] &&
        columns[1] === columns[2] &&
        columns[0]
      ) {
        return columns[0]
      }

    }

    const diagonals = [
      [
        this._squares[0][0].current?.getState.clicked,
        this._squares[1][1].current?.getState.clicked,
        this._squares[2][2].current?.getState.clicked,
      ],
      [
        this._squares[0][2].current?.getState.clicked,
        this._squares[1][1].current?.getState.clicked,
        this._squares[2][0].current?.getState.clicked,
      ],
    ]

    for (const diagonal of diagonals) {
      if (
        diagonal[0] === diagonal[1] &&
        diagonal[1] === diagonal[2] &&
        diagonal[0]
      ) {
        return diagonal[0]
      }
    }

    return ""
  }

  public render = (): HTMLElement[] => [0, 1, 2]
    // Create 3 rows
    .map((val) => createElement(
      "div",
      {class: "row"},
      // Create 3 columns
      [0, 1, 2].map((val2) => createElement(
        "div",
        {
          class: "col-4",
          onClick: () => {
            // Current square
            const square = this._squares[val][val2]
              .current

            // Check if square isn't already clicked
            if (square?.getState.clicked === "") {
              square?.setState({clicked: currentPlayer})
            }

            // Change current player
            if (currentPlayer === "x") {
              currentPlayer = "o"
            } else {
              currentPlayer = "x"
            }

            if (this._checkForWinner()) {
              alert(
                `Player ${this._checkForWinner()} has won the game!`
              )
            }
          },
        },
        createDSComponent(
          Square,
          {},
          this._squares[val][val2],
        )
      ))
    ))

}

class Square extends DS.default<{}, SquareState> {

  public constructor (parent: HTMLElement) {
    super(parent)

    this.state = {
      clicked: "",
    }
  }

  public render = (): HTMLElement => createElement(
    "div",
    {class: "tictactoe-square",},
    this.state.clicked,
  )

}

const tictactoeParent = document.getElementById("nested")

const mountTicTacToe = (): void => {
  if (tictactoeParent) {
    const tictactoe = new TicTacToe(tictactoeParent),
      resetBtn = document.getElementById("nested-reset-btn")
  
    if (resetBtn) {
      resetBtn.addEventListener("click", () => {
        tictactoe.unmount()

        mountTicTacToe()
      })
    }
  
    tictactoe.mount()
  }
}

mountTicTacToe()
        </code>
      </pre>
    </div>
  </div>

  <!-- Popper.js for bootstrap, not actually needed for functionality -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

  <!-- Bootstrap for styling, not actually needed for functionality -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script> 

  <!-- Prism JS for syntax hilighting code -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/plugins/autoloader/prism-autoloader.min.js"></script>

  <!-- Source Code of Examples -->
  <script src="./deStagnate.bundle.min.js"></script>
  <script src="compiled/counter.js"></script>
  <script src="src/props.js"></script>
  <script src="src/eventListener.js"></script>
  <script src="compiled/ref.js"></script>
  <script src="compiled/calculator.js"></script>
  <script src="src/svg.js"></script>
  <script src="compiled/tictactoe.js"></script>
  <script src="script.js"></script>
</body>
</html>